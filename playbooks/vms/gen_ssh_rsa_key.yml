---
- name: Generate an SSH RSA key
  hosts: pvenodes,template
  gather_facts: false
  roles:
    - global

  tasks:
  #   - name: Generate ssh key
  #     community.crypto.openssh_keypair:
  #       path: ~/.ssh/id_rsa
  #     delegate_to: localhost
  #     register: ssh_key

    # - name: Update ~/.ssh/known_hosts
    #   ansible.builtin.known_hosts:
    #     name: 192.168.2.64
    #     key: "{{ lookup('pipe', 'ssh-keyscan 192.168.2.64') }}"
    #     path: ~/.ssh/known_hosts
    #     state: present
    #   delegate_to: localhost

    # - name: Get IP address
    #   ansible.builtin.uri:
    #     url: 'https://pve-0.refol.us:8006/api2/json/nodes/pve-0/qemu/100/agent/network-get-interfaces'
    #     method: GET
    #     headers:
    #       Authorization: PVEAPIToken=ansible@refol.us!ansible=08755383-93f6-4b94-8af6-3b6cafc93fbc
    #     follow_redirects: safe
    #     validate_certs: false
    #   register: result
    #   delegate_to: localhost
    #   retries: 30
    #   delay: 30
    #   until: result.status == 200

    # - name: Show ip_addresses
    #   ansible.builtin.debug:
    #     msg: "{{ result.json.data.result[1]['ip-addresses'][0]['ip-address'] }}"

    # - name: Get OS info
    #   ansible.builtin.uri:
    #     url: 'https://pve-0.refol.us:8006/api2/json/nodes/pve-0/qemu/100/agent/get-osinfo'
    #     method: GET
    #     headers:
    #       Authorization: PVEAPIToken=ansible@refol.us!ansible=08755383-93f6-4b94-8af6-3b6cafc93fbc
    #     follow_redirects: safe
    #     validate_certs: false
    #   register: result
    #   delegate_to: localhost

    - name: Show os info
      ansible.builtin.debug:
        var: ansible_playbook_python
      delegate_to: localhost
