#cloud-config
autoinstall:
  version: 1
  locale: en_US
  timezone: America/New_York
  keyboard:
    layout: us
    variant: ""
    toggle: null
  identity:
    hostname: ubu24-template
    realname: 'Template user'
    username: '{{ global_vm_template_user }}'
    password: '{{ global_vm_template_user_crypted_password }}'
  storage:
    layout:
      name: lvm
      sizing-policy: all
  source:
    id: ubuntu-server-minimal
  network:
    version: 2
    ethernets:
      ens18:
        dhcp4: true
  ssh:
    install-server: yes
    allow-pw: true
    authorized-keys: 
      - "{{ ssh_key.public_key }}"
  packages:
    - vim
    - net-tools
    - realmd
    - sssd
    - sssd-tools
    - libnss-sss
    - libpam-sss
    - adcli
    - samba-common-bin
    - oddjob
    - oddjob-mkhomedir
    - packagekit
    - qemu-guest-agent
  late-commands:
    - echo '%ansible ALL=(ALL) NOPASSWD:ALL' > /target/etc/sudoers.d/99_ansible

