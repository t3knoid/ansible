---

- name: Stop carbon-cache
  ansible.builtin.command: "{{ graphite_setup_venv }}/bin/carbon-cache.py stop"
  args:
    chdir: "{{ graphite_setup_venv }}"
  register: graphite_setup_carbon_stop
  ignore_errors: true

- name: Check if carbon-cache stopped
  ansible.builtin.shell: |
    ps aux | grep '[c]arbon-cache.py'
    exit 0
  register: graphite_setup_carbon_cache_status
  changed_when: false

- name: Display if carbon-cache is stopped
  ansible.builtin.debug:
    msg: "carbon-cache stopped" 
  when: graphite_setup_carbon_cache_status.stdout_lines | length == 0
