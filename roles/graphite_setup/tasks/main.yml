---
# tasks file for graphite_setup
# see https://graphite.readthedocs.io/en/latest/install-virtualenv.html

- name: Update apt cache
  ansible.builtin.apt:
    update_cache: true
  become: true

- name: Install required dev headers for Graphite-web and Carbon
  ansible.builtin.apt:
    name:
      - python3-dev
      - libcairo2-dev
      - libffi-dev
      - build-essential
    state: present
    update_cache: true
  become: true

- name: Import venv.yml from python3 role
  ansible.builtin.import_role:
    name: python3
    tasks_from: venv.yml
  vars:
    python3_venv_folder: "{{ graphite_setup_home }}"

- name: Install Graphite modules
  ansible.builtin.pip:
    name: "{{ item }}"
    virtualenv: "{{ graphite_setup_home }}"
    state: present
  loop: "{{ graphite_setup_modules_to_install }}"

- name: Include webapp.yml
  ansible.builtin.include_tasks: webapp.yml

- name: Include whisper.yml
  ansible.builtin.include_tasks: whisper.yml

