---

- name: Install autofs
  ansible.builtin.apt:
    name: autofs
    state: present
    update_cache: true

- name: Configure /etc/auto.master
  ansible.builtin.template:
    src: auto.master.j2
    dest: /etc/auto.master
    mode: '0644'
    owner: root
    group: root
  notify: Restart autofs

- name: Append NFS mounts to auto.nfs
  ansible.builtin.blockinfile:
    path: /etc/auto.nfs
    mode: '0644'
    create: true
    marker: "# {mark} ANSIBLE MANAGED BLOCK"
    block: |
      {% for mount in autofs_nfs_mounts %}
      {{ mount.mount_name }} {{ mount.mount_options }} {{ mount.server }}
      {% endfor %}
  notify: Restart autofs
  when: autofs_nfs_mounts is defined and autofs_nfs_mounts | length > 0
