---

- name: Backup PostgreSQL database using pg_dump
  ansible.builtin.shell: |
    set -euo pipefail
    pg_dump -U {{ semaphoreui_setup_db_user }} -h {{ semaphoreui_setup_pg_host }} -Fc \
      --file={{ semaphoreui_setup_backup_path }} {{ semaphoreui_setup_db_name }}
  args:
    executable: /bin/bash
  become_user: postgres
  register: pg_backup_result
  failed_when: pg_backup_result.rc != 0
  changed_when: true
