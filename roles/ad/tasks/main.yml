---
# tasks file for ad

- name: Install required vms_packages_list
  ansible.builtin.apt:
    autoclean: true
    autoremove: true
    name: "{{ ad_required_packages | union(ad_additional_packages) }}"
    state: present

- name: Update /etc/resolv.conf with domain name
  ansible.builtin.lineinfile:
    path: /etc/resolv.conf
    regexp: '^search {{ global_domain_name }}$'
    line: "search {{ global_domain_name }}"
    state: present

- name: Update /etc/resolv.conf with DNS servers
  ansible.builtin.lineinfile:
    path: /etc/resolv.conf
    regexp: '^nameserver {{ item }}$'
    line: "nameserver {{ item }}"
    state: present
  loop: "{{ global_dns_servers }}"

- name: Discover domain
  ansible.builtin.command: "realm discover {{ global_domain_name }}"
  register: realm_command_output
  changed_when: realm_command_output exists

- name: Show realm_command_output
  ansible.builtin.debug:
    var: realm_command_output
