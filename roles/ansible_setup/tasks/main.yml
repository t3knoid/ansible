---

- name: Install Python modules
  ansible.builtin.pip:
    name: "{{ item }}"
    virtualenv: "/opt/python_{{ python3_version }}"
    state: present
    umask: "0022"
  loop: "{{ ansible_setup_python_modules }}"

- name: Set Git remote origin
  community.general.git_config:
    name: remote.origin.url
    scope: global
    value: "{{ ansible_setup_git_repository }}"
    repo: "{{ ansible_setup_workdir }}"
  become: false
  when: ansible_setup_git_repository_checkout
  
- name: Checkout ansible source repository
  ansible.builtin.git:
    repo: "{{ ansible_setup_git_repository }}"
    dest: "{{ ansible_setup_workdir }}"
    update: true
  become: false
  when: ansible_setup_git_repository_checkout

- name: Initialize ansible.cfg
  ansible.builtin.template:
    src: ansible.cfg.j2
    dest: "{{ ansible_setup_workdir }}/ansible.cfg"
    mode: "0664"
  become: false

- name: Create vault password file
  ansible.builtin.template:
    src: vault_pass.txt.j2
    dest: "~/.vault_pass.txt"
    mode: "0664"
  become: false
